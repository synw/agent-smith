# Subagents

An agent can use another agent like a tool. 

Example: we want our main agent to have the ability to create shell commands, but we don't want to use too much context window or have many tools available, so we will create a shellcmd subagent equiped with it's own tools.

The main agent has a `shellcmd`Â tool that is a subagent:

```yaml
description: An agent
prompt: |-
    {prompt}
ctx: 8192
model:
    name: qwen4b
    template: chatml-tools
inferParams:
    min_p: 0.05
    top_k: 40
    top_p: 0.95
    temperature: 0.5
toolsList:
    - shellcmd
```

The `shellcmd` subagent has it's own tools to execute it's specific mission:

```yaml
# agents/shellcmd.yml
tool:
    description: Write a shell command
    arguments:
        prompt: 
            description: The user request
name: shellcmd
description: Write a shell command using tools
prompt: |-
    {prompt}
template: 
    afterSystem: |-
        
        You are an AI programmer specialized in bash shell commands. Here is your workflow:

        - Evaluate the task and first grab documentation if useful (To retrieve documentation use the "dump-manpage" tool for simple commands, use doc-shell-cmd for commands with subcommands).
        - Important: you always use the "check-shellcmd" tool to evaluate the command security and correctness.
        - In your final answer always output only the command and the evaluation.

        Use the "check-shellcmd" tool to get an evaluation then provide your answer with this format:

        ```
        <command>command here</command>

        - Correctness: number
        - Security: number

        Security warning and recommandations if any
        Alternative secured command if any

        Short additional notes if needed
        ```
ctx: 8192
model:
    name: qwen4b
    template: chatml-tools
inferParams:
    min_p: 0
    top_k: 20
    top_p: 0.95
    temperature: 0.4
toolsList:
    - dump-manpage
    - check-shellcmd
```

This agent has tools: a simple system `dump-manpage` system tool:

```yaml
tool:
  description: Get documentation from an `man` page for a given shell command
  arguments:
    command:
        description: "The command name. Example: `find` or `chmod`"
cmd: man
args:
  - "-P"
  - "cat"
```

And a task `check-shellcmd`:

```yaml
tool:
    description: "Evaluate a shell command's' correctness and security. Provides a confidency score between 0.0 and 1.0 for both correctness and security"
    arguments:
        prompt: 
            description: The initial user request
        command: 
            description: The command to analyze
name: check-shellcmd
description: Check a shell command
prompt: |-
    We requested another AI to write a shell command. Initial user request: "{prompt}"

    The AI created this command:

    ```bash
    {command}
    ```

    Analyze the user request and review the command to check for:

    - **Correctness**: the command must do exactly what is requested by the user. Verify that it does it all correctly
    - Security problems if this command is run: only check for serious problems      
    - Simplicity and best practices: suggest alternatives if you find a better way to do what the user requested

    Provide a confidency score between 0.0 and 1.0 in you final report for:

    - Correctness
    - Security

    Suggest the good command if the correctness score is not 1.0
template: 
    system:  |-
        You are an AI programmer assistant for shell commands. You are in charge of the security and
        quality control.
ctx: 16384
model:    
    name: qwen30b
    template: chatml-tools
inferParams:
    temperature: 0
    max_tokens: 8192
variables:
    required:
        command:
            description: The shell command to check for
```