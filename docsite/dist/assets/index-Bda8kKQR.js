let t=[],v=(r,u)=>{let i=[],e={get(){return e.lc||e.listen(()=>{})(),e.value},l:u||0,lc:0,listen(n,f){return e.lc=i.push(n,f||e.l)/2,()=>{let a=i.indexOf(n);~a&&(i.splice(a,2),--e.lc||e.off())}},notify(n,f){let a=!t.length;for(let l=0;l<i.length;l+=2)t.push(i[l],i[l+1],e.value,n,f);if(a){for(let l=0;l<t.length;l+=5){let s;for(let o=l+1;!s&&(o+=5)<t.length;)t[o]<t[l+1]&&(s=t.push(t[l],t[l+1],t[l+2],t[l+3],t[l+4]));s||t[l](t[l+2],t[l+3],t[l+4])}t.length=0}},off(){},set(n){let f=e.value;f!==n&&(e.value=n,e.notify(f))},subscribe(n,f){let a=e.listen(n,f);return n(e.value),a},value:r};return e},p=(r={})=>{let u=v(r);return u.setKey=function(i,e){let n=u.value;typeof e>"u"&&i in u.value?(u.value={...u.value},delete u.value[i],u.notify(n,i)):u.value[i]!==e&&(u.value={...u.value,[i]:e},u.notify(n,i))},u};export{v as a,p as m};
