import{d as z,r as n,p as $,l as D,z as q,o as i,c as d,a as e,t as f,F as B,y as E,e as V,N as F,u as I,n as c,B as M,O as A,P as v,i as H}from"./index-BhJnANCl.js";import{s as O}from"./textarea.esm-BXWWJxwH.js";import{createChartPrompt as Q}from"./prompt-DN3W7Jwv.js";import{datasets as R}from"./datasets-BpzXXgAB.js";import{_ as G}from"./ChartTab.vue_vue_type_script_setup_true_lang-mjLMOCn2.js";import{_ as J}from"./CodeTab.vue_vue_type_script_setup_true_lang-B2R9qTVt.js";import{_ as U}from"./ErrorTab.vue_vue_type_script_setup_true_lang-CnbpRXof.js";import{_ as W}from"./PromptTab.vue_vue_type_script_setup_true_lang-BdLsjZlZ.js";import{_ as K}from"./InferParamsTab.vue_vue_type_style_index_0_lang-C2QXN1aE.js";const X={class:"flex flex-col space-y-3 w-full"},Y={class:"flex flex-row items-center prosed"},Z={class:"text-3xl txt-light capitalize"},tt=["innerHTML"],et=e("div",{class:"txt-light text-xl"},"Queries",-1),rt={class:"flex flex-col space-y-2 pt-2"},st=["onClick"],ot={key:1,class:"p-12 w-full flex flex-row items-center justify-center"},at=e("div",{class:"txt-light ml-3"},"Loading data ...",-1),lt={class:"flex flex-row pt-3"},nt=["disabled"],it={class:"flex flex-col pt-3 w-full",id:"tabs"},ct={class:"flex flex-row w-full"},dt=e("div",{class:"flex border-b bord-lighter flex-grow"},null,-1),ut={class:"pt-5"},pt="df.head(8).to_csv(index=False)",Ct=z({__name:"ViewDataset",props:{dataset:{type:String,required:!0}},emits:["pick"],setup(h,{emit:mt}){const p=h,m=n(!1),r=$({finalCode:"",finalPrompt:"",query:"",chart:{},error:""}),P={params:K,code:J,chart:G,prompt:W,error:U},s=n("params"),x=n(""),_=n(""),b=n(!1),g=$(new Array),y=n(new Array),L=`from vega_datasets import data

df = data('${p.dataset}')
df.to_html(classes='table-auto table-striped', max_rows=8, justify='left', col_space='8rem')`;async function N(){const{results:a,error:t}=await v.run(pt);_.value=a}async function S(){r.finalCode="",r.finalCode="",r.query="";const a=R[p.dataset];a.length>0&&g.push(...a);const{results:t,error:o}=await v.run(L);x.value=t,await N(),m.value=!0}function T(a){r.query=a;const{_prompt:t,tpl:o}=Q(a,_.value);y.value=o.stop??[],r.finalPrompt=t,s.value="prompt"}async function j(){var k;b.value=!1,r.chart={},r.finalCode="",s.value="code",(k=document.getElementById("tabs"))==null||k.scrollIntoView();const a=await q.think(r.finalPrompt,{temperature:0,max_tokens:500,top_p:.35,top_k:40,stop:y.value});let t="";try{t=w(a.text).replace("df = pd.read_csv('data.csv')",`df = data('${p.dataset}')`)}catch(l){r.error=`${l}`,s.value="error";return}if(t=t.replace("<|im_end|>","")+".to_json()",!t.startsWith("import")){console.log("Trying to patch code output");const l=t.split("import",1)[0];console.log("S",l),t=t.replace(l,"")}r.finalCode="```python\n"+t+"\n```";const{results:o,error:u}=await v.run(t);u&&(console.warn("Code err",u),r.error=`${u}`,s.value="error");let C="";try{C=w(o);const l=JSON.parse(C);r.chart=l,b.value=!0,s.value="chart"}catch(l){r.error=`${l}`,s.value="error";return}}function w(a){return a.replace("```python\n","").replace("```","").trim()}return D(()=>{q.discover(),S()}),(a,t)=>(i(),d("div",X,[e("div",Y,[e("h2",Z,f(h.dataset),1),e("button",{class:"btn bord-lighter txt-light text-sm ml-5",onClick:t[0]||(t[0]=o=>a.$emit("pick"))},"Pick another dataset")]),m.value?(i(),d(B,{key:0},[e("div",{innerHTML:x.value,class:"pt-3"},null,8,tt),et,e("div",rt,[(i(!0),d(B,null,E(g,o=>(i(),d("div",{onClick:u=>T(o.q),class:"cursor-pointer"},[e("span",null,f(o.q),1),H(" ( "+f(o.level)+"B) ",1)],8,st))),256))])],64)):(i(),d("div",ot,[V(F,{class:"text-5xl"}),at])),e("div",lt,[V(I(O),{class:"w-[32rem]",modelValue:r.query,"onUpdate:modelValue":t[1]||(t[1]=o=>r.query=o),rows:1},null,8,["modelValue"]),e("button",{class:c(["btn",r.query.length>0?"primary":"lighter"]),onClick:t[2]||(t[2]=o=>j()),disabled:!m.value||r.query.length==0},"Create chart",10,nt)]),e("div",it,[e("div",ct,[e("button",{class:c(["w-max p-2 border bord-lighter",s.value=="params"?["border-b-0","txt-light"]:"txt-semilight"]),onClick:t[3]||(t[3]=o=>s.value="params")},"Inference params",2),e("button",{class:c(["w-max p-2 border bord-lighter",s.value=="prompt"?["border-b-0","txt-light"]:"txt-semilight"]),onClick:t[4]||(t[4]=o=>s.value="prompt")},"Prompt",2),e("button",{class:c(["w-max p-2 border bord-lighter",s.value=="code"?["border-b-0","txt-light"]:"txt-semilight"]),onClick:t[5]||(t[5]=o=>s.value="code")},"Generated code",2),e("button",{class:c(["w-max p-2 border bord-lighter",s.value=="chart"?["border-b-0","txt-light"]:"txt-semilight"]),onClick:t[6]||(t[6]=o=>s.value="chart")},"Chart",2),e("button",{class:c(["w-max p-2 border bord-lighter",s.value=="error"?["border-b-0","txt-light"]:"txt-semilight"]),onClick:t[7]||(t[7]=o=>s.value="error")},"Error",2),dt]),e("div",ut,[(i(),M(A(P[s.value]),{data:r},null,8,["data"]))])])]))}});export{Ct as _};
