import{d as j,r as c,p as k,l as z,z as $,o as n,c as d,a as e,t as f,F as q,y as D,e as B,N as E,u as F,n as i,B as I,O as M,P as v,i as H}from"./index-Bb0ZNKHe.js";import{s as O}from"./textarea.esm-CzvdYmTw.js";import{tpl as Q,createChartPrompt as R}from"./prompt-mH73pdsL.js";import{datasets as A}from"./datasets-BpzXXgAB.js";import{_ as G}from"./ChartTab.vue_vue_type_script_setup_true_lang-DzRCxgR0.js";import{_ as J}from"./CodeTab.vue_vue_type_script_setup_true_lang-Ccu9D0MX.js";import{_ as U}from"./ErrorTab.vue_vue_type_script_setup_true_lang-CwQQkh6r.js";import{_ as W}from"./PromptTab.vue_vue_type_script_setup_true_lang-CWtorL4w.js";import{_ as K}from"./InferParamsTab.vue_vue_type_style_index_0_lang-3igIoIwe.js";const X={class:"flex flex-col space-y-3 w-full"},Y={class:"flex flex-row items-center prosed"},Z={class:"text-3xl txt-light capitalize"},tt=["innerHTML"],et=e("div",{class:"txt-light text-xl"},"Queries",-1),rt={class:"flex flex-col space-y-2 pt-2"},st=["onClick"],ot={key:1,class:"p-12 w-full flex flex-row items-center justify-center"},at=e("div",{class:"txt-light ml-3"},"Loading data ...",-1),lt={class:"flex flex-row pt-3"},nt=["disabled"],it={class:"flex flex-col pt-3 w-full",id:"tabs"},ct={class:"flex flex-row w-full"},dt=e("div",{class:"flex border-b bord-lighter flex-grow"},null,-1),ut={class:"pt-5"},pt="df.head(8).to_csv(index=False)",Ct=j({__name:"ViewDataset",props:{dataset:{type:String,required:!0}},emits:["pick"],setup(h,{emit:mt}){const p=h,m=c(!1),r=k({finalCode:"",finalPrompt:"",query:"",chart:{},error:""}),V={params:K,code:J,chart:G,prompt:W,error:U},s=c("params"),x=c(""),_=c(""),b=c(!1),g=k(new Array),P=`from vega_datasets import data

df = data('${p.dataset}')
df.to_html(classes='table-auto table-striped', max_rows=8, justify='left', col_space='8rem')`;async function L(){const{results:a,error:t}=await v.run(pt);_.value=a}async function N(){r.finalCode="",r.finalCode="",r.query="";const a=A[p.dataset];a.length>0&&g.push(...a);const{results:t,error:o}=await v.run(P);x.value=t,await L(),m.value=!0}function S(a){r.query=a;const t=R(a,_.value);r.finalPrompt=t,s.value="prompt"}async function T(){var C;b.value=!1,r.chart={},r.finalCode="",s.value="code",(C=document.getElementById("tabs"))==null||C.scrollIntoView();const a=await $.think(r.finalPrompt,{temperature:0,max_tokens:500,top_p:.35,top_k:40,stop:Q.stop});let t="";try{t=y(a.text).replace("df = pd.read_csv('data.csv')",`df = data('${p.dataset}')`)}catch(l){r.error=`${l}`,s.value="error";return}if(t=t.replace("<|im_end|>","")+".to_json()",!t.startsWith("import")){console.log("Trying to patch code output");const l=t.split("import",1)[0];console.log("S",l),t=t.replace(l,"")}r.finalCode="```python\n"+t+"\n```";const{results:o,error:u}=await v.run(t);u&&(console.warn("Code err",u),r.error=`${u}`,s.value="error");let w="";try{w=y(o);const l=JSON.parse(w);r.chart=l,b.value=!0,s.value="chart"}catch(l){r.error=`${l}`,s.value="error";return}}function y(a){return a.replace("```python\n","").replace("```","").trim()}return z(()=>{$.discover(),N()}),(a,t)=>(n(),d("div",X,[e("div",Y,[e("h2",Z,f(h.dataset),1),e("button",{class:"btn bord-lighter txt-light text-sm ml-5",onClick:t[0]||(t[0]=o=>a.$emit("pick"))},"Pick another dataset")]),m.value?(n(),d(q,{key:0},[e("div",{innerHTML:x.value,class:"pt-3"},null,8,tt),et,e("div",rt,[(n(!0),d(q,null,D(g,o=>(n(),d("div",{onClick:u=>S(o.q),class:"cursor-pointer"},[e("span",null,f(o.q),1),H(" ( "+f(o.level)+"B) ",1)],8,st))),256))])],64)):(n(),d("div",ot,[B(E,{class:"text-5xl"}),at])),e("div",lt,[B(F(O),{class:"w-[32rem]",modelValue:r.query,"onUpdate:modelValue":t[1]||(t[1]=o=>r.query=o),rows:1},null,8,["modelValue"]),e("button",{class:i(["btn",r.query.length>0?"primary":"lighter"]),onClick:t[2]||(t[2]=o=>T()),disabled:!m.value||r.query.length==0},"Create chart",10,nt)]),e("div",it,[e("div",ct,[e("button",{class:i(["w-max p-2 border bord-lighter",s.value=="params"?["border-b-0","txt-light"]:"txt-semilight"]),onClick:t[3]||(t[3]=o=>s.value="params")},"Inference params",2),e("button",{class:i(["w-max p-2 border bord-lighter",s.value=="prompt"?["border-b-0","txt-light"]:"txt-semilight"]),onClick:t[4]||(t[4]=o=>s.value="prompt")},"Prompt",2),e("button",{class:i(["w-max p-2 border bord-lighter",s.value=="code"?["border-b-0","txt-light"]:"txt-semilight"]),onClick:t[5]||(t[5]=o=>s.value="code")},"Generated code",2),e("button",{class:i(["w-max p-2 border bord-lighter",s.value=="chart"?["border-b-0","txt-light"]:"txt-semilight"]),onClick:t[6]||(t[6]=o=>s.value="chart")},"Chart",2),e("button",{class:i(["w-max p-2 border bord-lighter",s.value=="error"?["border-b-0","txt-light"]:"txt-semilight"]),onClick:t[7]||(t[7]=o=>s.value="error")},"Error",2),dt]),e("div",ut,[(n(),I(M(V[s.value]),{data:r},null,8,["data"]))])])]))}});export{Ct as _};
