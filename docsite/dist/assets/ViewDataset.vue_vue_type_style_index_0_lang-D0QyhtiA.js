import{d as A,r as n,q as $,l as D,x as q,c,o as i,a as e,t as f,F as V,A as E,g as B,Q as F,f as I,n as d,m as M,R as Q,S as v,i as R}from"./index-D3MkzR98.js";import{s as z}from"./index-DHddGRqq.js";import{createChartPrompt as H}from"./prompt-B2qM-Jtf.js";import{datasets as G}from"./datasets-BpzXXgAB.js";import{_ as J}from"./ChartTab.vue_vue_type_script_setup_true_lang-Cm5MNIr_.js";import{_ as O}from"./CodeTab.vue_vue_type_script_setup_true_lang-CF5NNKR4.js";import{_ as U}from"./ErrorTab.vue_vue_type_script_setup_true_lang-H5CtUana.js";import{_ as W}from"./PromptTab.vue_vue_type_script_setup_true_lang-DrgLmkrv.js";import{_ as K}from"./InferParamsTab.vue_vue_type_style_index_0_lang-DQgfd8jp.js";const X={class:"flex flex-col space-y-3 w-full"},Y={class:"flex flex-row items-center prosed"},Z={class:"text-3xl txt-light capitalize"},tt=["innerHTML"],et={class:"flex flex-col space-y-2 pt-2"},rt=["onClick"],st={key:1,class:"p-12 w-full flex flex-row items-center justify-center"},ot={class:"flex flex-row pt-3"},at=["disabled"],lt={class:"flex flex-col pt-3 w-full",id:"tabs"},nt={class:"flex flex-row w-full"},it={class:"pt-5"},dt="df.head(8).to_csv(index=False)",_t=A({__name:"ViewDataset",props:{dataset:{type:String,required:!0}},emits:["pick"],setup(x,{emit:ct}){const p=x,m=n(!1),r=$({finalCode:"",finalPrompt:"",query:"",chart:{},error:""}),P={params:K,code:O,chart:J,prompt:W,error:U},s=n("params"),b=n(""),h=n(""),g=n(!1),_=$(new Array),y=n(new Array),S=`from vega_datasets import data

df = data('${p.dataset}')
df.to_html(classes='table-auto table-striped', max_rows=8, justify='left', col_space='8rem')`;async function L(){const{results:a,error:t}=await v.run(dt);h.value=a}async function T(){r.finalCode="",r.finalCode="",r.query="";const a=G[p.dataset];a.length>0&&_.push(...a);const{results:t,error:o}=await v.run(S);b.value=t,await L(),m.value=!0}function j(a){r.query=a;const{_prompt:t,tpl:o}=H(a,h.value);y.value=o.stop??[],r.finalPrompt=t,s.value="prompt"}async function N(){var k;g.value=!1,r.chart={},r.finalCode="",s.value="code",(k=document.getElementById("tabs"))==null||k.scrollIntoView();const a=await q.think(r.finalPrompt,{temperature:0,max_tokens:500,top_p:.35,top_k:40,stop:y.value});let t="";try{t=w(a.text).replace("df = pd.read_csv('data.csv')",`df = data('${p.dataset}')`)}catch(l){r.error=`${l}`,s.value="error";return}if(t=t.replace("<|im_end|>","")+".to_json()",!t.startsWith("import")){console.log("Trying to patch code output");const l=t.split("import",1)[0];console.log("S",l),t=t.replace(l,"")}r.finalCode="```python\n"+t+"\n```";const{results:o,error:u}=await v.run(t);u&&(console.warn("Code err",u),r.error=`${u}`,s.value="error");let C="";try{C=w(o);const l=JSON.parse(C);r.chart=l,g.value=!0,s.value="chart"}catch(l){r.error=`${l}`,s.value="error";return}}function w(a){return a.replace("```python\n","").replace("```","").trim()}return D(()=>{q.discover(),T()}),(a,t)=>(i(),c("div",X,[e("div",Y,[e("h2",Z,f(x.dataset),1),e("button",{class:"btn bord-lighter txt-light text-sm ml-5",onClick:t[0]||(t[0]=o=>a.$emit("pick"))},"Pick another dataset")]),m.value?(i(),c(V,{key:0},[e("div",{innerHTML:b.value,class:"pt-3"},null,8,tt),t[8]||(t[8]=e("div",{class:"txt-light text-xl"},"Queries",-1)),e("div",et,[(i(!0),c(V,null,E(_,o=>(i(),c("div",{onClick:u=>j(o.q),class:"cursor-pointer"},[e("span",null,f(o.q),1),R(" ( "+f(o.level)+"B) ",1)],8,rt))),256))])],64)):(i(),c("div",st,[B(F,{class:"text-5xl"}),t[9]||(t[9]=e("div",{class:"txt-light ml-3"},"Loading data ...",-1))])),e("div",ot,[B(I(z),{class:"w-[32rem]",modelValue:r.query,"onUpdate:modelValue":t[1]||(t[1]=o=>r.query=o),rows:1},null,8,["modelValue"]),e("button",{class:d(["btn",r.query.length>0?"primary":"lighter"]),onClick:t[2]||(t[2]=o=>N()),disabled:!m.value||r.query.length==0},"Create chart",10,at)]),e("div",lt,[e("div",nt,[e("button",{class:d(["w-max p-2 border bord-lighter",s.value=="params"?["border-b-0","txt-light"]:"txt-semilight"]),onClick:t[3]||(t[3]=o=>s.value="params")},"Inference params",2),e("button",{class:d(["w-max p-2 border bord-lighter",s.value=="prompt"?["border-b-0","txt-light"]:"txt-semilight"]),onClick:t[4]||(t[4]=o=>s.value="prompt")},"Prompt",2),e("button",{class:d(["w-max p-2 border bord-lighter",s.value=="code"?["border-b-0","txt-light"]:"txt-semilight"]),onClick:t[5]||(t[5]=o=>s.value="code")},"Generated code",2),e("button",{class:d(["w-max p-2 border bord-lighter",s.value=="chart"?["border-b-0","txt-light"]:"txt-semilight"]),onClick:t[6]||(t[6]=o=>s.value="chart")},"Chart",2),e("button",{class:d(["w-max p-2 border bord-lighter",s.value=="error"?["border-b-0","txt-light"]:"txt-semilight"]),onClick:t[7]||(t[7]=o=>s.value="error")},"Error",2),t[10]||(t[10]=e("div",{class:"flex border-b bord-lighter flex-grow"},null,-1))]),e("div",it,[(i(),M(Q(P[s.value]),{data:r},null,8,["data"]))])])]))}});export{_t as _};
